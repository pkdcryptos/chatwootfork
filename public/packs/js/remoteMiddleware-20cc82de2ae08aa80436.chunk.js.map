{"version":3,"sources":["webpack:///./node_modules/@june-so/analytics-next/dist/pkg/plugins/remote-middleware/index.js"],"names":["remoteMiddlewares","ctx","settings","obfuscate","_a","this","path","remoteMiddleware","names","scripts","_this","_b","label","enabledMiddleware","Object","entries","filter","map","name","nonNamespaced","bundleName","fullPath","error_1","replace","btoa","concat","trys","push","sent","window","log","stats","increment","Promise","all","Boolean"],"mappings":"4FAAA,+FAIO,SAASA,EAAkBC,EAAKC,EAAUC,GAC/C,IAAIC,EAEJ,OAAO,YAAUC,UAAM,OAAQ,GAAQ,WACrC,IAAIC,EAAMC,EAAkBC,EAAOC,EAE/BC,EAAQL,KAEZ,OAAO,YAAYA,MAAM,SAAUM,GACjC,OAAQA,EAAGC,OACT,KAAK,EACH,OAAI,cACK,CAAC,EAEN,KAGJN,EAAO,cACPC,EAAyD,QAArCH,EAAKF,EAASW,yBAAsC,IAAPT,EAAgBA,EAAK,GACtFI,EAAQM,OAAOC,QAAQR,GAAkBS,QAAO,SAAUZ,GAChDA,EAAG,GAEX,OADcA,EAAG,MAEhBa,KAAI,SAAUb,GAEf,OADWA,EAAG,MAGhBK,EAAUD,EAAMS,KAAI,SAAUC,GAC5B,OAAO,YAAUR,OAAO,OAAQ,GAAQ,WACtC,IAAIS,EAAeC,EAAYC,EAAUC,EACzC,OAAO,YAAYjB,MAAM,SAAUD,GACjC,OAAQA,EAAGQ,OACT,KAAK,EACHO,EAAgBD,EAAKK,QAAQ,YAAa,IAC1CH,EAAaD,EAEThB,IACFiB,EAAaI,KAAKL,GAAeI,QAAQ,KAAM,KAGjDF,EAAW,GAAGI,OAAOnB,EAAM,gBAAgBmB,OAAOL,EAAY,YAAYK,OAAOL,EAAY,UAC7FhB,EAAGQ,MAAQ,EAEb,KAAK,EAGH,OAFAR,EAAGsB,KAAKC,KAAK,CAAC,EAAG,EAAE,CAAE,IAEd,CAAC,EAEN,YAAWN,IAGf,KAAK,EAIH,OAHAjB,EAAGwB,OAGI,CAAC,EAENC,OAAO,GAAGJ,OAAON,EAAe,gBAEpC,KAAK,EAIH,OAHAG,EAAUlB,EAAGwB,OACb3B,EAAI6B,IAAI,QAASR,GACjBrB,EAAI8B,MAAMC,UAAU,4BACb,CAAC,EAEN,GAEJ,KAAK,EACH,MAAO,CAAC,aAOX,CAAC,EAENC,QAAQC,IAAIzB,KAEhB,KAAK,EAGH,MAAO,CAAC,EAFKE,EAAGiB,OACQZ,OAAOmB","file":"js/remoteMiddleware-20cc82de2ae08aa80436.chunk.js","sourcesContent":["import { __awaiter, __generator } from \"tslib\";\nimport { isServer } from '../../core/environment';\nimport { loadScript } from '../../lib/load-script';\nimport { getNextIntegrationsURL } from '../../lib/parse-cdn';\nexport function remoteMiddlewares(ctx, settings, obfuscate) {\n  var _a;\n\n  return __awaiter(this, void 0, void 0, function () {\n    var path, remoteMiddleware, names, scripts, middleware;\n\n    var _this = this;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          if (isServer()) {\n            return [2\n            /*return*/\n            , []];\n          }\n\n          path = getNextIntegrationsURL();\n          remoteMiddleware = (_a = settings.enabledMiddleware) !== null && _a !== void 0 ? _a : {};\n          names = Object.entries(remoteMiddleware).filter(function (_a) {\n            var _ = _a[0],\n                enabled = _a[1];\n            return enabled;\n          }).map(function (_a) {\n            var name = _a[0];\n            return name;\n          });\n          scripts = names.map(function (name) {\n            return __awaiter(_this, void 0, void 0, function () {\n              var nonNamespaced, bundleName, fullPath, error_1;\n              return __generator(this, function (_a) {\n                switch (_a.label) {\n                  case 0:\n                    nonNamespaced = name.replace('@segment/', '');\n                    bundleName = nonNamespaced;\n\n                    if (obfuscate) {\n                      bundleName = btoa(nonNamespaced).replace(/=/g, '');\n                    }\n\n                    fullPath = \"\".concat(path, \"/middleware/\").concat(bundleName, \"/latest/\").concat(bundleName, \".js.gz\");\n                    _a.label = 1;\n\n                  case 1:\n                    _a.trys.push([1, 3,, 4]);\n\n                    return [4\n                    /*yield*/\n                    , loadScript(fullPath) // @ts-ignore\n                    ];\n\n                  case 2:\n                    _a.sent(); // @ts-ignore\n\n\n                    return [2\n                    /*return*/\n                    , window[\"\".concat(nonNamespaced, \"Middleware\")]];\n\n                  case 3:\n                    error_1 = _a.sent();\n                    ctx.log('error', error_1);\n                    ctx.stats.increment('failed_remote_middleware');\n                    return [3\n                    /*break*/\n                    , 4];\n\n                  case 4:\n                    return [2\n                    /*return*/\n                    ];\n                }\n              });\n            });\n          });\n          return [4\n          /*yield*/\n          , Promise.all(scripts)];\n\n        case 1:\n          middleware = _b.sent();\n          middleware = middleware.filter(Boolean);\n          return [2\n          /*return*/\n          , middleware];\n      }\n    });\n  });\n}"],"sourceRoot":""}